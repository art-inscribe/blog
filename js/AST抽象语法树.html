<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>AST æŠ½è±¡è¯­æ³•æ ‘ | Yé“­çš„åšå®¢</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="ä¸ªäººåšå®¢">
    
    <link rel="preload" href="/blog/assets/css/0.styles.d3d2db5e.css" as="style"><link rel="preload" href="/blog/assets/js/app.1f6ff52c.js" as="script"><link rel="preload" href="/blog/assets/js/2.1a90d8d2.js" as="script"><link rel="preload" href="/blog/assets/js/9.e2ea4f18.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.ac1d5c45.js"><link rel="prefetch" href="/blog/assets/js/11.b69cfc85.js"><link rel="prefetch" href="/blog/assets/js/12.9d397fda.js"><link rel="prefetch" href="/blog/assets/js/13.e0a39bae.js"><link rel="prefetch" href="/blog/assets/js/14.6fa77682.js"><link rel="prefetch" href="/blog/assets/js/15.a3c75717.js"><link rel="prefetch" href="/blog/assets/js/3.dba40c6f.js"><link rel="prefetch" href="/blog/assets/js/4.d7cd0258.js"><link rel="prefetch" href="/blog/assets/js/5.c1c2b1c5.js"><link rel="prefetch" href="/blog/assets/js/6.a644d090.js"><link rel="prefetch" href="/blog/assets/js/7.e1840d54.js"><link rel="prefetch" href="/blog/assets/js/8.9ac3f109.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.d3d2db5e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/assets/img/logo.jpg" alt="Yé“­çš„åšå®¢" class="logo"> <span class="site-name can-hide">Yé“­çš„åšå®¢</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/js/" class="nav-link router-link-active">
  js
</a></div><div class="nav-item"><a href="/blog/webpack/" class="nav-link">
  webpack
</a></div><div class="nav-item"><a href="https://www.baidu.com.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  css
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/js/" class="nav-link router-link-active">
  js
</a></div><div class="nav-item"><a href="/blog/webpack/" class="nav-link">
  webpack
</a></div><div class="nav-item"><a href="https://www.baidu.com.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  css
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog/js/" aria-current="page" class="sidebar-link">jsæ€»ç»“</a></li><li><a href="/blog/js/jså¸¸ç”¨çš„æ•°ç»„æ–¹æ³•.html" class="sidebar-link">JSä¸­çš„Arrayæ–¹æ³•</a></li><li><a href="/blog/js/jsé€»è¾‘è¿ç®—ç¬¦.html" class="sidebar-link">jsé€»è¾‘è¿ç®—ç¬¦</a></li><li><a href="/blog/js/ASTæŠ½è±¡è¯­æ³•æ ‘.html" class="active sidebar-link">AST æŠ½è±¡è¯­æ³•æ ‘</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/js/ASTæŠ½è±¡è¯­æ³•æ ‘.html#ast-æ˜¯ä»€ä¹ˆ" class="sidebar-link">AST æ˜¯ä»€ä¹ˆ</a></li><li class="sidebar-sub-header"><a href="/blog/js/ASTæŠ½è±¡è¯­æ³•æ ‘.html#ast-æœ‰ä»€ä¹ˆç”¨" class="sidebar-link">AST æœ‰ä»€ä¹ˆç”¨</a></li><li class="sidebar-sub-header"><a href="/blog/js/ASTæŠ½è±¡è¯­æ³•æ ‘.html#ast-å¦‚ä½•ç”Ÿæˆ" class="sidebar-link">AST å¦‚ä½•ç”Ÿæˆ</a></li><li class="sidebar-sub-header"><a href="/blog/js/ASTæŠ½è±¡è¯­æ³•æ ‘.html#å®æˆ˜-ast-çš„è¿ç”¨" class="sidebar-link">å®æˆ˜ AST çš„è¿ç”¨</a></li><li class="sidebar-sub-header"><a href="/blog/js/ASTæŠ½è±¡è¯­æ³•æ ‘.html#æ€»ç»“" class="sidebar-link">æ€»ç»“</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ast-æŠ½è±¡è¯­æ³•æ ‘"><a href="#ast-æŠ½è±¡è¯­æ³•æ ‘" class="header-anchor">#</a> AST æŠ½è±¡è¯­æ³•æ ‘</h1> <h2 id="ast-æ˜¯ä»€ä¹ˆ"><a href="#ast-æ˜¯ä»€ä¹ˆ" class="header-anchor">#</a> AST æ˜¯ä»€ä¹ˆ</h2> <p>æŠ½è±¡è¯­æ³•æ ‘ (Abstract Syntax Tree)ï¼Œç®€ç§° ASTï¼Œå®ƒæ˜¯æºä»£ç è¯­æ³•ç»“æ„çš„ä¸€ç§æŠ½è±¡è¡¨ç¤ºã€‚å®ƒä»¥æ ‘çŠ¶çš„å½¢å¼è¡¨ç°ç¼–ç¨‹è¯­è¨€çš„è¯­æ³•ç»“æ„ï¼Œæ ‘ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½è¡¨ç¤ºæºä»£ç ä¸­çš„ä¸€ç§ç»“æ„ã€‚</p> <h2 id="ast-æœ‰ä»€ä¹ˆç”¨"><a href="#ast-æœ‰ä»€ä¹ˆç”¨" class="header-anchor">#</a> AST æœ‰ä»€ä¹ˆç”¨</h2> <p>AST è¿ç”¨å¹¿æ³›ï¼Œæ¯”å¦‚ï¼š</p> <ul><li>ç¼–è¾‘å™¨çš„é”™è¯¯æç¤ºã€ä»£ç æ ¼å¼åŒ–ã€ä»£ç é«˜äº®ã€ä»£ç è‡ªåŠ¨è¡¥å…¨ï¼›</li> <li>elintã€pretiier å¯¹ä»£ç é”™è¯¯æˆ–é£æ ¼çš„æ£€æŸ¥ï¼›</li> <li>webpack é€šè¿‡ babel è½¬è¯‘ javascript è¯­æ³•ï¼›
å¹¶ä¸”å¦‚æœä½ æƒ³äº†è§£ js ç¼–è¯‘æ‰§è¡Œçš„åŸç†ï¼Œé‚£ä¹ˆä½ å°±å¾—äº†è§£ ASTã€‚</li></ul> <h2 id="ast-å¦‚ä½•ç”Ÿæˆ"><a href="#ast-å¦‚ä½•ç”Ÿæˆ" class="header-anchor">#</a> AST å¦‚ä½•ç”Ÿæˆ</h2> <p>s æ‰§è¡Œçš„ç¬¬ä¸€æ­¥æ˜¯è¯»å– js æ–‡ä»¶ä¸­çš„å­—ç¬¦æµï¼Œç„¶åé€šè¿‡è¯æ³•åˆ†æç”Ÿæˆ tokenï¼Œä¹‹åå†é€šè¿‡è¯­æ³•åˆ†æ( Parser )ç”Ÿæˆ ASTï¼Œæœ€åç”Ÿæˆæœºå™¨ç æ‰§è¡Œã€‚
æ•´ä¸ªè§£æè¿‡ç¨‹ä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸¤ä¸ªæ­¥éª¤ï¼š</p> <ul><li>åˆ†è¯ï¼šå°†æ•´ä¸ªä»£ç å­—ç¬¦ä¸²åˆ†å‰²æˆæœ€å°è¯­æ³•å•å…ƒæ•°ç»„</li> <li>è¯­æ³•åˆ†æï¼šåœ¨åˆ†è¯åŸºç¡€ä¸Šå»ºç«‹åˆ†æè¯­æ³•å•å…ƒä¹‹é—´çš„å…³ç³»
JS Parser æ˜¯ js è¯­æ³•è§£æå™¨ï¼Œå®ƒå¯ä»¥å°† js æºç è½¬æˆ ASTï¼Œå¸¸è§çš„ Parser æœ‰ esprimaã€traceurã€acornã€shift ç­‰</li></ul> <h3 id="è¯æ³•åˆ†æ"><a href="#è¯æ³•åˆ†æ" class="header-anchor">#</a> è¯æ³•åˆ†æ</h3> <p>è¯æ³•åˆ†æï¼Œä¹Ÿç§°ä¹‹ä¸ºæ‰«æï¼ˆscannerï¼‰ï¼Œç®€å•æ¥è¯´å°±æ˜¯è°ƒç”¨ next() æ–¹æ³•ï¼Œä¸€ä¸ªä¸€ä¸ªå­—æ¯çš„æ¥è¯»å–å­—ç¬¦ï¼Œç„¶åä¸å®šä¹‰å¥½çš„ JavaScript å…³é”®å­—ç¬¦åšæ¯”è¾ƒï¼Œç”Ÿæˆå¯¹åº”çš„Tokenã€‚Token æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„æœ€å°å•å…ƒ:</p> <blockquote><p>ä¾‹å¦‚ var è¿™ä¸‰ä¸ªå­—ç¬¦ï¼Œå®ƒåªèƒ½ä½œä¸ºä¸€ä¸ªæ•´ä½“ï¼Œè¯­ä¹‰ä¸Šä¸èƒ½å†è¢«åˆ†è§£ï¼Œå› æ­¤å®ƒæ˜¯ä¸€ä¸ª Tokenã€‚</p></blockquote> <p>è¯æ³•åˆ†æå™¨é‡Œï¼Œæ¯ä¸ªå…³é”®å­—æ˜¯ä¸€ä¸ª Token ï¼Œæ¯ä¸ªæ ‡è¯†ç¬¦æ˜¯ä¸€ä¸ª Tokenï¼Œæ¯ä¸ªæ“ä½œç¬¦æ˜¯ä¸€ä¸ª Tokenï¼Œæ¯ä¸ªæ ‡ç‚¹ç¬¦å·ä¹Ÿéƒ½æ˜¯ä¸€ä¸ª Tokenã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜ä¼šè¿‡æ»¤æ‰æºç¨‹åºä¸­çš„æ³¨é‡Šå’Œç©ºç™½å­—ç¬¦ï¼ˆæ¢è¡Œç¬¦ã€ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ç­‰ã€‚
æœ€ç»ˆï¼Œæ•´ä¸ªä»£ç å°†è¢«åˆ†å‰²è¿›ä¸€ä¸ªtokensåˆ—è¡¨ï¼ˆæˆ–è€…è¯´ä¸€ç»´æ•°ç»„ï¼‰ã€‚</p> <h3 id="è¯­æ³•åˆ†æ"><a href="#è¯­æ³•åˆ†æ" class="header-anchor">#</a> è¯­æ³•åˆ†æ</h3> <p>è¯­æ³•åˆ†æä¼šå°†è¯æ³•åˆ†æå‡ºæ¥çš„ Token è½¬åŒ–æˆæœ‰è¯­æ³•å«ä¹‰çš„æŠ½è±¡è¯­æ³•æ ‘ç»“æ„ã€‚åŒæ—¶ï¼ŒéªŒè¯è¯­æ³•ï¼Œè¯­æ³•å¦‚æœæœ‰é”™çš„è¯ï¼ŒæŠ›å‡ºè¯­æ³•é”™è¯¯ã€‚
è¯´äº†è¿™ä¹ˆå¤šæˆ‘ä»¬æ¥çœ‹ä¸‹ javaScript ä»£ç ç‰‡æ®µè½¬æˆ AST ä¹‹åæ˜¯ä»€ä¹ˆæ ·çš„æˆ‘ä»¬æ‹¿ä¸€è¡Œç®€å•çš„ä»£ç æ¥å±•ç¤º</p> <h3 id="ä¾‹å­-1"><a href="#ä¾‹å­-1" class="header-anchor">#</a> ä¾‹å­ 1</h3> <p><code>const fn = a =&gt; a;</code></p> <p><img src="https://img-blog.csdnimg.cn/2021042914063084.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzEyODc1MQ==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°">
å¦‚å›¾ä»è¿™ä¸ª AST è¯­æ³•æ ‘æˆ‘ä»¬å°±èƒ½å¤Ÿå¾ˆæ¸…æ¥šçš„çœ‹å‡ºä¸€ä¸ªä»£ç ä»–çš„å…·ä½“å«ä¹‰ï¼Œå¹¶ä¸”ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆè¯­æ³•ï¼Œæ–¹æ³•ç­‰ã€‚
ç”¨äººè¯ç¿»è¯‘è¿™ä¸ªå›¾å°±æ˜¯ï¼šç”¨ç±»å‹ const å£°æ˜å˜é‡ fn æŒ‡å‘ä¸€ä¸ªç®­å¤´å‡½æ•°è¡¨è¾¾å¼ï¼Œå®ƒçš„å‚æ•°æ˜¯ a å‡½æ•°ä½“ä¹Ÿæ˜¯ aã€‚</p> <h3 id="ä¾‹å­-2"><a href="#ä¾‹å­-2" class="header-anchor">#</a> ä¾‹å­ 2</h3> <div class="language- extra-class"><pre class="language-text"><code>const fn = a =&gt; {
	let i = 1;
  return a + i;
};
</code></pre></div><p><img src="https://img-blog.csdnimg.cn/2021042914072668.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzEyODc1MQ==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> <h3 id="ä¾‹å­-3"><a href="#ä¾‹å­-3" class="header-anchor">#</a> ä¾‹å­ 3</h3> <div class="language- extra-class"><pre class="language-text"><code>function test(){
  let a = 1;
  console.log(a)
}
</code></pre></div><p><img src="https://img-blog.csdnimg.cn/20210429140758371.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzEyODc1MQ==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°">
ä»¥ä¸Šæˆªå›¾å‡æ˜¯ä½¿ç”¨ Acorn è§£æã€‚ä½¿ç”¨ Acorn çš„åŸå› æ˜¯æ®æˆ‘äº†è§£åœ¨ parser è§£æä¸­ï¼ŒAcorn æ˜¯å…¬è®¤çš„æœ€å¿«çš„ã€‚å¹¶ä¸”æˆ‘ä»¬ä½¿ç”¨çš„ Webpack æ‰“åŒ…å·¥å…·ä¸­ babel ç”¨çš„ä¹Ÿæ˜¯ Acornã€‚
ä¸Šè¿°æˆªå›¾çš„å±æ€§æ˜¯ AST çš„ä¸€éƒ¨åˆ†ï¼Œè¿™ä¸ªç»“æ„åŒ…å«äº†å¾ˆå¤šå±æ€§ã€‚</p> <ul><li>VariableDeclaration å˜é‡å£°æ˜</li> <li>VariableDeclarator å˜é‡å£°æ˜çš„æè¿°</li> <li>Expression è¡¨è¾¾å¼èŠ‚ç‚¹</li></ul> <p>æ›´å¤šå±æ€§å±•ç¤ºï¼š</p> <ol><li>å¯ä»¥å» AST explorer å¯ä»¥åœ¨çº¿çœ‹åˆ°ä¸åŒçš„ parser è§£æ js ä»£ç åå¾—åˆ°çš„ ASTã€‚</li> <li>github ä¸Šçœ‹æ‰€æœ‰çš„ ESTree <a href="https://github.com/estree/estree" target="_blank" rel="noopener noreferrer">ESTree<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>å…³äºå±æ€§ä»‹ç»çš„æ–‡æ¡£ æŠ½è±¡è¯­æ³•æ ‘ASTä»‹ç»</li></ol> <h2 id="å®æˆ˜-ast-çš„è¿ç”¨"><a href="#å®æˆ˜-ast-çš„è¿ç”¨" class="header-anchor">#</a> å®æˆ˜ AST çš„è¿ç”¨</h2> <h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="header-anchor">#</a> é¢˜ç›®</h3> <p>é€šè¿‡ä¸Šé¢ä»‹ç»çš„ console.log ASTï¼Œä¸‹é¢æˆ‘ä»¬å°±æ¥å®Œæˆä¸€ä¸ªåœ¨è°ƒç”¨ console.log(xx) æ—¶å€™ç»™å‰é¢åŠ ä¸€ä¸ªå‡½æ•°åï¼Œè¿™æ ·ç”¨æˆ·åœ¨æ‰“å°æ—¶å€™èƒ½æ”¹æ–¹ä¾¿çœ‹åˆ°æ˜¯å“ªä¸ªå‡½æ•°è°ƒç”¨çš„ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// æºä»£ç </span>
<span class="token keyword">function</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// --------------------</span>
<span class="token comment">// è½¬åŒ–åä»£ç </span>
<span class="token keyword">function</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;getData&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ä»‹ç»
é¦–å…ˆä»‹ç»ä¸‹æˆ‘ä»¬éœ€è¦ä½¿ç”¨çš„å·¥å…· Babel</p> <ul><li>@babel/parser : å°† js ä»£ç  -------&gt;&gt;&gt;  AST æŠ½è±¡è¯­æ³•æ ‘ï¼›</li> <li>@babel/traverse å¯¹ AST èŠ‚ç‚¹è¿›è¡Œé€’å½’éå†ï¼›</li> <li>@babel/types å¯¹å…·ä½“çš„ AST èŠ‚ç‚¹è¿›è¡Œè¿›è¡Œä¿®æ”¹ï¼›</li> <li>@babel/generator :  AST æŠ½è±¡è¯­æ³•æ ‘ -------&gt;&gt;&gt; æ–°çš„ js ä»£ç ï¼›
ä¸ºä»€ä¹ˆä½¿ç”¨ babel ? ä¸»è¦æ˜¯æ¯”è¾ƒå¥½ç”¨ï¼ˆåªå¯¹è¿™ä¸ªæ¯”è¾ƒç†Ÿæ‚‰ğŸ˜­ï¼‰ã€‚
è¿›å…¥ @babel/parser å®˜ç½‘å¼€å¤´å°±ä»‹ç»äº†å®ƒæ˜¯ä½¿ç”¨çš„ Acorn æ¥è§£æ js ä»£ç æˆ AST è¯­æ³•æ ‘ï¼ˆè¯´æ˜ç¡®å® Acorn æ¯”è¾ƒå¥½ï¼‰ã€‚</li></ul> <p><img src="https://img-blog.csdnimg.cn/2021042914111484.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzEyODc1MQ==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> <h3 id="å¼€å§‹ç èµ·æ¥"><a href="#å¼€å§‹ç èµ·æ¥" class="header-anchor">#</a> å¼€å§‹ç èµ·æ¥</h3> <ol><li>æ–°å»ºæ–‡ä»¶æ‰“å¼€æ§åˆ¶å°å®‰è£…éœ€è¦çš„åŒ…</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>cnpm i @babel<span class="token operator">/</span>parser @babel<span class="token operator">/</span>traverse @babel<span class="token operator">/</span>types @babel<span class="token operator">/</span>generator <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><ol start="2"><li>åˆ›å»º js æ–‡ä»¶, ç¼–å†™å¤§è‡´å¸ƒå±€å¦‚ä¸‹ ä½¿ç”¨ AST</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> generator <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/generator&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> parser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/parser&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> traverse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/traverse&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> types <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/types&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">compile</span><span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1.parse å°†ä»£ç è§£æä¸ºæŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰</span>
  <span class="token keyword">const</span> ast <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 2,traverse è½¬æ¢ä»£ç </span>
  traverse<span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 3. generator å°† AST è½¬å›æˆä»£ç </span>
  <span class="token keyword">return</span> generator<span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
function getData() {
  console.log(&quot;data&quot;)
}
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">const</span> newCode <span class="token operator">=</span> <span class="token function">compile</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span>
</code></pre></div><p>ä½¿ç”¨ node è·‘å‡ºç»“æœï¼Œå› ä¸ºä»€ä¹ˆéƒ½æ²¡å¤„ç†ï¼Œè¾“å‡ºçš„æ˜¯åŸä»£ç 
<img src="https://img-blog.csdnimg.cn/20210429141217819.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzEyODc1MQ==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°">
å®Œå–„ compile æ–¹æ³•</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">compile</span><span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1.parse</span>
  <span class="token keyword">const</span> ast <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 2,traverse</span>
  <span class="token keyword">const</span> visitor <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function">CallExpression</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// æ‹¿åˆ° callee æ•°æ®</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> callee <span class="token punctuation">}</span> <span class="token operator">=</span> path<span class="token punctuation">.</span>node<span class="token punctuation">;</span>
      <span class="token comment">// åˆ¤æ–­æ˜¯å¦æ˜¯è°ƒç”¨äº† console.log æ–¹æ³•</span>
      <span class="token comment">// 1. åˆ¤æ–­æ˜¯å¦æ˜¯æˆå‘˜è¡¨è¾¾å¼èŠ‚ç‚¹ï¼Œä¸Šé¢æˆªå›¾æœ‰è¯¦ç»†ä»‹ç»</span>
      <span class="token comment">// 2. åˆ¤æ–­æ˜¯å¦æ˜¯ console å¯¹è±¡</span>
      <span class="token comment">// 3. åˆ¤æ–­å¯¹è±¡çš„å±æ€§æ˜¯å¦æ˜¯ log</span>
      <span class="token keyword">const</span> isConsoleLog <span class="token operator">=</span>
        types<span class="token punctuation">.</span><span class="token function">isMemberExpression</span><span class="token punctuation">(</span>callee<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        callee<span class="token punctuation">.</span>object<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&quot;console&quot;</span> <span class="token operator">&amp;&amp;</span>
        callee<span class="token punctuation">.</span>property<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&quot;log&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>isConsoleLog<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å¦‚æœæ˜¯ console.log çš„è°ƒç”¨ æ‰¾åˆ°ä¸Šä¸€ä¸ªçˆ¶èŠ‚ç‚¹æ˜¯å‡½æ•°</span>
        <span class="token keyword">const</span> funcPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">findParent</span><span class="token punctuation">(</span><span class="token parameter">p</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> p<span class="token punctuation">.</span><span class="token function">isFunctionDeclaration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å–å‡½æ•°çš„åç§°</span>
        <span class="token keyword">const</span> funcName <span class="token operator">=</span> funcPath<span class="token punctuation">.</span>node<span class="token punctuation">.</span>id<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
        <span class="token comment">// å°†åç§°é€šè¿‡ types æ¥æ”¾åˆ°å‡½æ•°çš„å‚æ•°å‰é¢å»</span>
        path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>arguments<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>types<span class="token punctuation">.</span><span class="token function">stringLiteral</span><span class="token punctuation">(</span>funcName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">// traverse è½¬æ¢ä»£ç </span>
  traverse<span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> visitor<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 3. generator å°† AST è½¬å›æˆä»£ç </span>
  <span class="token keyword">return</span> generator<span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>çº¯ä»£ç çœ‹èµ·æ¥æ¯”è¾ƒéš¾ç†è§£ä¸‹é¢æ˜¯æˆ‘å°†ä¸Šé¢çš„ path.node å†™å…¥åˆ°æ–‡ä»¶ä¸­ç»™å¤§å®¶çœ‹ä¸‹æ•°æ®æ ¼å¼ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;CallExpression&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;start&quot;</span><span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
  <span class="token string">&quot;end&quot;</span><span class="token operator">:</span> <span class="token number">43</span><span class="token punctuation">,</span>
  <span class="token string">&quot;loc&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;start&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;line&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;column&quot;</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;end&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;line&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;column&quot;</span><span class="token operator">:</span> <span class="token number">21</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">&quot;callee&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;MemberExpression&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;start&quot;</span><span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
    <span class="token string">&quot;end&quot;</span><span class="token operator">:</span> <span class="token number">35</span><span class="token punctuation">,</span>
    <span class="token string">&quot;loc&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;start&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;line&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;column&quot;</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">&quot;end&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;line&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;column&quot;</span><span class="token operator">:</span> <span class="token number">13</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;object&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;start&quot;</span><span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
      <span class="token string">&quot;end&quot;</span><span class="token operator">:</span> <span class="token number">31</span><span class="token punctuation">,</span>
      <span class="token string">&quot;loc&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;start&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;line&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;column&quot;</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&quot;end&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;line&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;column&quot;</span><span class="token operator">:</span> <span class="token number">9</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&quot;identifierName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;console&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;console&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;property&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;start&quot;</span><span class="token operator">:</span> <span class="token number">32</span><span class="token punctuation">,</span>
      <span class="token string">&quot;end&quot;</span><span class="token operator">:</span> <span class="token number">35</span><span class="token punctuation">,</span>
      <span class="token string">&quot;loc&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;start&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;line&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;column&quot;</span><span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&quot;end&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;line&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;column&quot;</span><span class="token operator">:</span> <span class="token number">13</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&quot;identifierName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;log&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;log&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;computed&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">&quot;arguments&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;StringLiteral&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;start&quot;</span><span class="token operator">:</span> <span class="token number">36</span><span class="token punctuation">,</span>
      <span class="token string">&quot;end&quot;</span><span class="token operator">:</span> <span class="token number">42</span><span class="token punctuation">,</span>
      <span class="token string">&quot;loc&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;start&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;line&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;column&quot;</span><span class="token operator">:</span> <span class="token number">14</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&quot;end&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;line&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;column&quot;</span><span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">&quot;extra&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;rawValue&quot;</span><span class="token operator">:</span> <span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;raw&quot;</span><span class="token operator">:</span> <span class="token string">&quot;'data'&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;data&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æˆ‘ä»¬å°†ä¸å¿…è¦çš„ä½ç½®ä¿¡æ¯ï¼ˆstart, end, locï¼‰å±æ€§åˆ é™¤ï¼Œå¯¹ç…§æ•°æ®æ¥çœ‹ä»£ç å°†ä¼šä¸€ç›®äº†ç„¶
<img src="https://img-blog.csdnimg.cn/20210429141321274.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzEyODc1MQ==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"> <img src="https://img-blog.csdnimg.cn/20210429141332543.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzEyODc1MQ==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°">
å¾ˆå¥½ï¼Œè°ƒç”¨ console.log æ–¹æ³•å‚æ•°å‰é¢å¢åŠ äº†å‡½æ•°åï¼Œå®Œæˆï¼ï¼
ä¸ºäº†å¤§å®¶èƒ½å¤Ÿæ–¹ä¾¿è¿è¡Œï¼Œä¸‹é¢æ˜¯å®Œæ•´ä»£ç </p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> generator <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/generator&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> parser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/parser&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> traverse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/traverse&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> types <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/types&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">compile</span><span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1.parse</span>
  <span class="token keyword">const</span> ast <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 2,traverse</span>
  <span class="token keyword">const</span> visitor <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function">CallExpression</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> callee <span class="token punctuation">}</span> <span class="token operator">=</span> path<span class="token punctuation">.</span>node<span class="token punctuation">;</span>
      <span class="token keyword">const</span> isConsoleLog <span class="token operator">=</span>
        types<span class="token punctuation">.</span><span class="token function">isMemberExpression</span><span class="token punctuation">(</span>callee<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        callee<span class="token punctuation">.</span>object<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&quot;console&quot;</span> <span class="token operator">&amp;&amp;</span>
        callee<span class="token punctuation">.</span>property<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&quot;log&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>isConsoleLog<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> funcPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">findParent</span><span class="token punctuation">(</span><span class="token parameter">p</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> p<span class="token punctuation">.</span><span class="token function">isFunctionDeclaration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> funcName <span class="token operator">=</span> funcPath<span class="token punctuation">.</span>node<span class="token punctuation">.</span>id<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
        fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token string">&quot;./funcPath.json&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>funcPath<span class="token punctuation">.</span>node<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;å†™å…¥æˆåŠŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>arguments<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>types<span class="token punctuation">.</span><span class="token function">stringLiteral</span><span class="token punctuation">(</span>funcName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  traverse<span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> visitor<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 3. generator</span>
  <span class="token keyword">return</span> generator<span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
function getData() {
  console.log('data')
}
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">compile</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">.</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="header-anchor">#</a> æ€»ç»“</h2> <p>ä¸ºäº†å…¼å®¹ä½ç‰ˆæœ¬æµè§ˆå™¨ æˆ‘ä»¬ä¹Ÿé€šå¸¸ä¼šä½¿ç”¨ webpack æ‰“åŒ…ç¼–è¯‘æˆ‘ä»¬çš„ä»£ç å°† ES6 è¯­æ³•é™ä½ç‰ˆæœ¬ï¼Œæ¯”å¦‚ç®­å¤´å‡½æ•°å˜æˆæ™®é€šå‡½æ•°ã€‚å°† constã€let å£°æ˜æ”¹æˆ var ç­‰ç­‰ï¼Œä»–éƒ½æ˜¯é€šè¿‡ AST æ¥å®Œæˆçš„ï¼Œåªä¸è¿‡å®ç°çš„è¿‡ç¨‹æ¯”è¾ƒå¤æ‚ï¼Œç²¾è‡´ã€‚ä¸è¿‡ä¹Ÿéƒ½æ˜¯è¿™ä¸‰æ¿æ–§ï¼š</p> <ol><li>js è¯­æ³•è§£ææˆ ASTï¼›</li> <li>ä¿®æ”¹ ASTï¼›</li> <li>AST è½¬æˆ js è¯­æ³•</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/blog/js/jsé€»è¾‘è¿ç®—ç¬¦.html" class="prev">
        jsé€»è¾‘è¿ç®—ç¬¦
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/blog/assets/js/app.1f6ff52c.js" defer></script><script src="/blog/assets/js/2.1a90d8d2.js" defer></script><script src="/blog/assets/js/9.e2ea4f18.js" defer></script>
  </body>
</html>
